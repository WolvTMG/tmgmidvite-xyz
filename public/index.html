<head>
    <title id="animatedTitle">TMG</title>
    <link rel="icon" type="image/png" href="images/favicon.ico">
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/ab03fc73b8.js" crossorigin="anonymous"></script>
</head>

<body>
    <div id="splash">
        <div class="splashText">Welcome | いらっしゃいませ</div>
        <div class="kanjiText">Welcome | いらっしゃいませ</div>
    </div>
    <div class="videoBackground">
        <video id="bgVideo" muted>
            <source src="images/akaza.mp4" type="video/mp4">
        </video>
        <img id="bgFallback" src="images/akaza.png" alt="Fallback Background">
    </div>
    <div class="centerBox">
        <div class="kanjiText">不名誉よりも死</div>
        <div class="centerRow">
            <img class="centerPhoto" src="images/logo.png" alt="Logo">
            <div class="centerText">wolvtmg</div>
        </div>
        <div class="centerDescription">Without an ego, who are you truly?</div>


        <div class="currentTrack" id="currentTrack">Loading...</div>

        <div class="centerLinks">
            <a href="https://tmgmidvite.com" target="_blank" class="linkPortfolio">
                <i class="fa-solid fa-folder-open"></i>
            </a>
            <a href="https://github.com/WolvTMG" target="_blank" class="linkGithub">
                <i class="fa-brands fa-github"></i>
            </a>
            <a href="https://www.youtube.com/@wolvtmg2045" target="_blank" class="linkYoutube">
                <i class="fa-brands fa-youtube"></i>
            </a>
            <a href="https://discord.gg/uYCeDP3" target="_blank" class="linkDiscord">
                <i class="fa-brands fa-discord"></i>
            </a>
        </div>

        <div class="player">
            <audio id="audio" src="sounds/akaza.mp3"></audio>

            <div class="controls">
                <span id="currentTime">00:00</span>
                <input type="range" id="seekBar" value="0" step="1">
                <span id="duration">00:00</span>
                <button id="playPause">▶</button>
                <input type="range" id="volume" min="0" max="1" step="0.01" value="1">
            </div>
        </div>
    </div>

    <script>
        const audio = document.getElementById("audio");
        const video = document.getElementById("bgVideo");
        const playPause = document.getElementById("playPause");
        const seekBar = document.getElementById("seekBar");
        const currentTimeEl = document.getElementById("currentTime");
        const durationEl = document.getElementById("duration");
        const volume = document.getElementById("volume");

        playPause.addEventListener("click", () => {
            if (audio.paused) {
                audio.play();
                video.play();
                playPause.textContent = "❚❚";
            } else {
                audio.pause();
                video.pause();
                playPause.textContent = "▶";
            }
        });

        audio.addEventListener("ended", () => {
            playPause.textContent = "▶"; 
            video.pause();  
        });

        video.addEventListener("ended", () => {
            playPause.textContent = "▶";
        });

        audio.addEventListener("loadedmetadata", () => {
            durationEl.textContent = formatTime(audio.duration);
            seekBar.max = Math.floor(audio.duration);
            updateSliderBackground(seekBar);
            updateSliderBackground(volume);
        });

        audio.addEventListener("timeupdate", () => {
            seekBar.value = Math.floor(audio.currentTime);
            currentTimeEl.textContent = formatTime(audio.currentTime);
            updateSliderBackground(seekBar);


            if (Math.abs(video.currentTime - audio.currentTime) > 0.3) {
                video.currentTime = audio.currentTime;
            }
        });

        seekBar.addEventListener("input", () => {
            audio.currentTime = seekBar.value;
            video.currentTime = seekBar.value;
            updateSliderBackground(seekBar);
        });

        // Volume control
        volume.addEventListener("input", () => {
            audio.volume = volume.value;
            video.volume = volume.value;
            updateSliderBackground(volume);
        });

        // --- Helper functions ---
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${String(mins).padStart(2,"0")}:${String(secs).padStart(2,"0")}`;
        }

        function updateSliderBackground(slider) {
            let value = (slider.value - slider.min) / (slider.max - slider.min) * 100;
            slider.style.background = `linear-gradient(to right, white ${value}%, #444 ${value}%)`;
        }


        document.addEventListener('DOMContentLoaded', function() {
            const centerBox = document.querySelector('.centerBox');
            
            centerBox.addEventListener('mousemove', function(e) {
                const rect = centerBox.getBoundingClientRect();
                
                const x = Math.max(-1, Math.min(1, (e.clientX - rect.left) / rect.width * 2 - 1));
                const y = Math.max(-1, Math.min(1, (e.clientY - rect.top) / rect.height * 2 - 1));
                
                const tiltY = x * 10;
                const tiltX = y * -10;
                
                centerBox.style.transform = `perspective(1000px) rotateX(${tiltX}deg) rotateY(${tiltY}deg)`;
            });
            
            centerBox.addEventListener('mouseleave', function() {
                centerBox.style.transform = 'perspective(1000px) rotateX(0) rotateY(0)';
            });
            
            document.addEventListener('mouseleave', function() {
                centerBox.style.transform = 'perspective(1000px) rotateX(0) rotateY(0)';
            });
        });


        document.addEventListener('DOMContentLoaded', function() {
            const links = document.querySelectorAll('.centerLinks a');
            
            links.forEach(link => {
                const popup = document.createElement('div');
                popup.className = 'linkPopup';
                
                if (link.classList.contains('linkPortfolio')) {
                    popup.textContent = 'Portfolio';
                } else if (link.classList.contains('linkGithub')) {
                    popup.textContent = 'GitHub';
                } else if (link.classList.contains('linkYoutube')) {
                    popup.textContent = 'YouTube';
                } else if (link.classList.contains('linkDiscord')) {
                    popup.textContent = 'Discord';
                }
                
                document.body.appendChild(popup);
                
                link.addEventListener('mouseenter', function(e) {
                    const rect = this.getBoundingClientRect();
                    popup.style.left = (rect.left + rect.width / 2 - popup.offsetWidth / 2) + 'px';
                    popup.style.top = (rect.top - popup.offsetHeight - 10) + 'px';
                    popup.style.opacity = '1';
                    popup.style.transform = 'translateY(0)';
                });
                
                link.addEventListener('mouseleave', function() {
                    popup.style.opacity = '0';
                    popup.style.transform = 'translateY(10px)';
                });
            });
        });


        const title = "TMG";
        let index = 1;
        let forward = true;

        function animateTabTitle() {
        document.title = title[0] + title.slice(1, index);

        if (forward) {
            index++;
            if (index > title.length) {
            index = title.length - 1;
            forward = false;
            }
        } else {
            index--;
            if (index < 1) {
            index = 2;
            forward = true;
            }
        }

        setTimeout(animateTabTitle, 500);
        }

        animateTabTitle();


        document.addEventListener("DOMContentLoaded", () => {
            const splash = document.getElementById("splash");
            const content = document.querySelector(".centerBox");

            splash.addEventListener("click", () => {
                splash.classList.add("fade-out");

                audio.volume = 1;
                video.volume = 1;

                if (audio.paused) audio.play();
                if (video.paused) video.play();

                playPause.textContent = "❚❚";

                setTimeout(() => {
                    splash.style.display = "none";
                    content.style.display = "flex";
                }, 500);
            });
        });


        const fallback = document.getElementById("bgFallback");

        let videoStarted = false;

        video.addEventListener("play", () => {
            fallback.style.display = "none";
            videoStarted = true;
        });

        video.addEventListener("ended", () => {
            fallback.style.display = "block";
        });

        video.addEventListener("pause", () => {
            if (videoStarted) {
                fallback.style.display = "block";
            }
        });


        function fadeVideo(paused) {
            if (paused) {
                video.style.opacity = 0;
            } else {
                video.style.opacity = 1;
            }
        }

        audio.addEventListener("play", () => fadeVideo(false));
        audio.addEventListener("pause", () => fadeVideo(true));


        async function fetchTrack() {
            try {
                const res = await fetch('https://tmgmidvite.xyz/current-track');
                const data = await res.json();

                const track = data.track && data.track.trim() !== "" ? data.track : null;
                const artist = data.artist && data.artist.trim() !== "" ? data.artist : null;

                if (track && artist) {
                    document.getElementById('currentTrack').innerHTML = 
                        `Currently listening to <div class="currentTrackSong">${track}</div> by <div class="currentTrackArtists">${artist}</div>`;
                } else {
                    document.getElementById('currentTrack').textContent = 'Not listening to anything right now';
                }
            } catch (err) {
                console.error(err);
                document.getElementById('currentTrack').textContent = 'Error fetching track';
            }
        }

        fetchTrack();
        setInterval(fetchTrack, 10000);
    </script>
</body>
